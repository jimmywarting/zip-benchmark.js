var b="File format is not recognized.";var U=new TextDecoder,d=(n,t)=>n[t]|n[t+1]<<8,A=Uint8Array.from([31,139,8,0,0,0,0,0,0,0]);function w(n,t){return n.slice(t.offset+26,t.offset+30).bytes().then(e=>{let r=d(e,0)+d(e,2)+30,i=t.offset+r,s=i+t.compressedSize;return n.slice(i,s)})}var y=class{#t;#r;#e={};#n;type="";constructor(t,e){if(t.getUint32(0)!==1347092738)throw new Error("ERR_BAD_FORMAT");let r=t;this.#t=r,this.#r=e;for(let i=46+this.filenameLength;i<r.byteLength;){let s=r.getUint16(i,!0),c=r.getUint16(i+2,!0),h=r.byteOffset+i+4;this.#e[s]=new DataView(r.buffer.slice(h,h+c)),i+=c+4}}get versionMadeBy(){return this.#t.getUint16(4,!0)}get versionNeeded(){return this.#t.getUint16(6,!0)}get bitFlag(){return this.#t.getUint16(8,!0)}get encrypted(){return(this.bitFlag&1)===1}get compressionMethod(){return this.#t.getUint16(10,!0)}get crc32(){return this.#t.getUint32(16,!0)}get compressedSize(){return this.#t.getUint32(20,!0)}get filenameLength(){return this.#t.getUint16(28,!0)}get extraFieldLength(){return this.#t.getUint16(30,!0)}get commentLength(){return this.#t.getUint16(32,!0)}get diskNumberStart(){return this.#t.getUint16(34,!0)}get internalFileAttributes(){return this.#t.getUint16(36,!0)}get externalFileAttributes(){return this.#t.getUint32(38,!0)}get directory(){return!!(this.#t.getUint8(38)&16)||this.size===0&&this.name.endsWith("/")}get offset(){return this.#t.getUint32(42,!0)}get zip64(){return this.#t.getUint32(24,!0)===4294967295}get comment(){let t=this.#t,e=new Uint8Array(t.buffer,t.byteOffset+this.filenameLength+this.extraFieldLength+46,this.commentLength);return U.decode(e)}get lastModified(){let t=this.#t.getUint32(12,!0);return new Date((t>>25&127)+1980,(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(t&31)<<1).getTime()}set lastModified(t){if(typeof t!="number")throw new TypeError("lastModified must be a number");let e=new Date(t),r=e.getFullYear()-1980<<25|e.getMonth()+1<<21|e.getDate()<<16|e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>1;this.#t.setUint32(12,r,!0)}get name(){if(this.#n!==void 0)return this.#n;if(!this.bitFlag&&this.#e[28789])return this.#n=U.decode(this.#e[28789].buffer.slice(5));let t=this.#t,e=new Uint8Array(t.buffer,t.byteOffset+46,this.filenameLength);return this.#n=U.decode(e)}set name(t){if(typeof t!="string")throw new TypeError("name must be a string");this.#n=t}get size(){let t=this.#t.getUint32(24,!0);return t===4294967295?this.#e[1].getUint8(0):t}set size(t){t>4294967295&&(this.#e[1]=new DataView(new ArrayBuffer(1)),this.#e[1].setUint8(0,t))}rawBytes(){return w(this.#r,this)}async bytes(){if(!this.compressionMethod)return w(this.#r,this).then(r=>r.bytes());let t=new Uint8Array(this.size),e=0;for await(let r of this.stream())t.set(r,e),e+=r.byteLength;return t}stream(){let t=new TransformStream,e=this.crc32,r=this.size;return this.rawBytes().then(i=>{let s=i.stream();if(this.compressionMethod){let c=new TransformStream({start(h){h.enqueue(A)},flush(h){let g=new DataView(new ArrayBuffer(8));g.setUint32(0,e,!0),g.setUint32(4,r,!0),h.enqueue(new Uint8Array(g.buffer))}});s.pipeThrough(c).pipeThrough(new DecompressionStream("gzip")).pipeTo(t.writable)}else s.pipeTo(t.writable)}),t.readable}async arrayBuffer(){return(await this.bytes()).buffer}async text(){return this.compressionMethod?new Response(this.stream()).text().catch(t=>{throw new Error(`Failed to read Entry
${t}`)}):w(this.#r,this).then(t=>t.text())}async file(){return(this.compressionMethod?this.arrayBuffer():w(this.#r,this)).then(e=>new File([e],this.name,{lastModified:this.lastModified})).catch(e=>{throw new Error(`Failed to read Entry
${e}`)})}};function m(n,t,e=!1){return n.getBigInt64(t,e)}async function*E(n){if(n.size<22)throw new Error(b);async function t(f){let a=await n.slice(n.size-f).arrayBuffer(),o=new Uint8Array(a);for(let u=o.length-22;u>=0;u--)if(o[u]===80&&o[u+1]===75&&o[u+2]===5&&o[u+3]===6)return new DataView(o.buffer,u,22);return null}let e=await t(22)||await t(Math.min(65558,n.size));if(!e)throw new Error(b);let r=e.getUint16(8,!0),i=e.getUint32(12,!0),s=e.getUint32(16,!0);if(s===4294967295){let f=-e.byteLength-20;e=new DataView(await n.slice(f,-e.byteLength).arrayBuffer());let a=e.getUint32(0,!0),o=e.getUint32(4,!0),u=Number(m(e,8,!0)),D=e.getUint32(16,!0),M=n.slice(u,f);e=new DataView(await M.arrayBuffer()),r=Number(m(e,32,!0)),i=Number(m(e,40,!0)),s=Number(m(e,48,!0))}if(s<0||s>=n.size)throw new Error(b);let h=s,g=s+i,p=n.slice(h,g),l=new Uint8Array(await p.arrayBuffer());for(let f=0,a=0;f<r;f++){let o=d(l,a+28)+d(l,a+30)+d(l,a+32)+46;if(a+o>l.length)throw new Error("Invalid ZIP file.");yield new y(new DataView(l.buffer,a,o),n),a+=o}}var x=E;export{x as Reader};
/*! Bundled license information:

zip-go/lib/read.js:
  (*! zip64. MIT License. Jimmy WÃ¤rting <https://jimmy.warting.se/opensource> *)
*/
